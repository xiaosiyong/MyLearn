# TiDB相关
### 背景：当前数据库面临的问题
在缩放、一致性、大数据分析、与云基础架构集成等方面均存在诸多问题，现有的数据库解决方案和大数据分析引擎解决方案基本处于割裂的状态，由于Oracle、MySQL数据库并不是面向分布式环境所涉及，因此即使勉强通过分库、分表或中间件的方式，在数据库层面做了分片，从本质上看也只是复制了相同的堆栈，而非针对分布式系统进行存储和计算优化，这正是进行跨业务查询或跨物理机查询和写入十分繁琐的本质原因。NoSQL虽然解决了数据库弹性扩展的难题，但是却放弃了数据的强一致性以及对ACID事务的支持，带来了新的问题。

### TiDB 架构

![15f15969c7cd187a99c2c2072db2ad93](/Users/iss/Desktop/15f15969c7cd187a99c2c2072db2ad93.jpg)

TiDB 由分布式SQL层(TiDB)，分布式KV存储引擎(TiKV)以及管理整个集群的PD模块组成。无线水平扩展是TiDB的一大特点。

## TiDB的应用场景

###1、MySQL 分片与合并

对于已经在用MySQL的业务，分库、分表、分片、中间件是常用手段，随着分片的增多，跨分片查询是一大难题。TiDB在业务层兼容MySQL的访问协议，PingCAP做了一个数据同步的工具——Syncer，它可以把TiDB作为一个MySQL Slave，将TiDB作为现有数据库的从库接在主MySQL库的后方，在这一层将数据打通，可以直接进行复杂的跨库、跨表、跨业务的实时SQL查询。过去的数据库都是一主多从，有了TiDB以后，可以反过来做到多主一从。

### 2、直接替换MySQL

在一个TiDB的数据库上，所有业务场景不需要做分库分表，所有的分布式工作都由数据库层完成。TiDB兼容MySQL协议，所以可以直接替换MySQL，而且基本做到了开箱即用，完全不用担心传统分库分表方案带来繁重的工作负担和复杂的维护成本，友好的用户界面让常规的技术人员可以高效地进行维护和管理。另外，TiDB具有NoSQL类似的扩容能力，在数据量和访问流量持续增长的情况下能够通过水平扩容提高系统的业务支撑能力，并且响应延迟稳定。

### 3、数据仓库

TiDB本身是一个分布式系统，可作为数据仓库使用。当TiDB的SQL出现瓶颈的时候，可用TiSpark，可以直接用Spark SQL 实时在TiKV上做大数据分析。

###  4、作为其他系统的模块 

TiDB是传统的存储跟计算分离的项目，底层的Key-Value层，可单独作为HBase的Replacement，同时支持跨行事务。TiDB对外提供两个API接口，一个是ACID Transaction的API，用于支持跨行事务；另一个是Raw API，可以做单行的事务，提升了整个的性能，但不提供跨行事务的ACID支持。

## TiDB设计的思路

### 1、为什么SQL层和存储层分开

- 对运维的友好性(有bug升级方便)
- 成本(存储和计算依赖的资源不一样)
- 更加灵活，可以使用不同的开发语言，对于无状态的计算层，选择Go语言，而对于存储层TiKV，选用Rust，稳定，无垃圾回收，不会造成抖动

### 2、一些特性

- 高度兼容MySQL，无缝迁移 
- 水平弹性扩展，加节点扩容
- 分布式事务，100%支持标准的ACID事务
- 金融级高可用，相比于传统主从（M-S）复制方案，基于Raft的多数选举协议可以提供金融级别的100%数据强一致性，大多数副本不丢失的前提下，故障自动恢复。
- HTAP解决方案（Hybrid Transactional analytical processing）
- 云原生SQL数据库、支持公有云、私有云、混合云，部署，配置，维护简单

核心特性：**水平扩展与高可用**